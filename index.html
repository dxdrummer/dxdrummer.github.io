<!DOCTYPE html>
<html>
    
    <style type="text/css">
    
        .line {
            fill: none;
            stroke-width: 3;
        }
        
        .dot {
            fill: #ffab00;
            stroke: #fff;
        }
        
        .focus circle{
            fill: none;
            stroke: steelblue;
            
        }
    
    </style>
<head>
	<meta charset="utf-8">
	<title>CS 498 Data Viz Final Project</title>
	<meta name="author" content="Neale Mason">
</head>

<script src='https://d3js.org/d3.v5.min.js'></script>
    
<body>
    
    <h1>Top 20 Video Game Sales 1985-2016</h1>
    
    <svg width="500" height="500"></svg>
    
    <script>
        var n = 20;
        var margin = {top: 100, right: 100, bottom: 100, left: 100},
        width = window.innerWidth - margin.left - margin.right,
        height = window.innerHeight - margin.top - margin.bottom;
        
        var xScale = d3.scaleLinear().domain([1985, 2019]).range([0, width]);
        
        var yScale = d3.scaleLinear().domain([0,1]).range([height,0]);
        
        var line = d3.line()
            .x(function(d, i){return xScale(i);})
            .y(function(d){ return yScale(d.y);})
            
        
        var data1 = '/data/salesByGenre.csv';
        
        var dataset = d3.range(n).map(function(d){ return {"y": data1.Global_Sales, "x": data1.Year_of_Release}})

        var svg = d3.select("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform", "translate("+margin.left+","+margin.top+")");
        
    
        d3.select("svg")
            .append("g")
                .attr("class", "x axis")
            .attr("transform", "translate(0, "+ height +")")
            .call(d3.axisBottom(xScale));
            

        d3.select("svg")
            .append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(yScale));
        
        svg.append("path")
            .datum(dataset)
            .attr("class", "line")
            .attr("d", line)
        
        svg.selectAll(".dot")
            .data(dataset)
            .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", function(d,i){return xScale(i)})
                .attr("cy", function(d){return yScale(d.y)})
                .attr("r", 5)
                    .on("mouseover", function(a, b, c){
                        console.log(a)
                        this.attr('class', 'focus')
                    })
                          .on("mouseout", function() {  })
                         .on("mousemove", mousemove);

                       var focus = svg.append("g")
                          .attr("class", "focus")
                           .style("display", "none");

                      focus.append("circle")
                           .attr("r", 4.5);

                      focus.append("text")
                          .attr("x", 9)
                    .attr("dy", ".35em");

                       svg.append("rect")
                         .attr("class", "overlay")
                          .attr("width", width)
                           .attr("height", height)
                         .on("mouseover", function() { focus.style("display", null); })
                        .on("mouseout", function() { focus.style("display", "none"); })
                           .on("mousemove", mousemove);

                      function mousemove() {
                        var x0 = x.invert(d3.mouse(this)[0]),
                             i = bisectDate(data, x0, 1),
                            d0 = data[i - 1],
                         d1 = data[i],
                            d = x0 - d0.date > d1.date - x0 ? d1 : d0;
                       focus.attr("transform", "translate(" + x(d.date) + "," + y(d.close) + ")");
                       focus.select("text").text(d);
                    }


    </script>

</body>
</html>
